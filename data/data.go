package data

import (
	"bufio"
	"encoding/csv"
	"fmt"
	"log"
	"net/http"
	"os"
)

func GetCsv(uriEndpoint string) ([][]string, int) {
	res, err := http.Get(uriEndpoint)
	if err != nil {
		log.Fatal(err)
	}
	r := csv.NewReader(res.Body)
	rec, _ := r.ReadAll()
	return rec, len(rec)
}

func IfExist(id *string, filename string) bool {
	f, err := os.Open(filename)
	if err != nil {
		log.Fatal(err)
	}
	defer f.Close()

	scan := bufio.NewScanner(f)
	for scan.Scan() {
		if scan.Text() == *id {
			return true
		}
	}
	return false
}

func AddId(id *string, filename string) {
	f, err := os.OpenFile(filename, os.O_APPEND|os.O_WRONLY, 0600)
	if err != nil {
		log.Fatal(err)
	}
	defer f.Close()

	text := fmt.Sprintf("%s\n", *id)
	_, err = f.WriteString(text)
	if err != nil {
		log.Fatal(err)
	}
	log.Printf("ID added: %s", *id)
}
